# Find the directory dynamically
FIREFOX_DIR=$(find "$(pwd)" -maxdepth 1 -type d -name "firefox*")

# Create the .mozconfig file
cat > "$FIREFOX_DIR/.mozconfig" << EOF
ac_add_options --prefix=/usr
ac_add_options --libdir=/usr/lib${LIBDIRSUFFIX}
ac_add_options --enable-application=js
mk_add_options MOZ_OBJDIR="\$MOZOBJ"
ac_add_options --enable-release
ac_add_options --enable-hardening
ac_add_options --enable-optimize
ac_add_options --enable-rust-simd
ac_add_options --enable-linker=lld
ac_add_options --disable-bootstrap
ac_add_options --disable-debug
ac_add_options --disable-debug-symbols
ac_add_options --disable-jemalloc
ac_add_options --disable-strip
ac_add_options --with-system-zlib
ac_add_options --without-system-icu
ac_add_options --enable-readline
ac_add_options --enable-shared-js
ac_add_options --enable-tests
ac_add_options --with-intl-api
EOF

# Set environment variables
export MOZBUILD_STATE_PATH="$FIREFOX_DIR/.mozbuild"
export MACH_BUILD_PYTHON_NATIVE_PACKAGE_SOURCE=none

# Run the build process
"$FIREFOX_DIR/mach" build

# Move to the object directory and install
cd "$FIREFOX_DIR/obj" || exit 1
make install DESTDIR="$PKG"
cd ..
