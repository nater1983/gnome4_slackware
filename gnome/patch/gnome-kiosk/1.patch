From 700880e83d0c263658ccc6db5ef4232f94667090 Mon Sep 17 00:00:00 2001
From: Nathaniel Russell <naterussell83@gmail.com>
Date: Fri, 7 Mar 2025 00:27:38 +0000
Subject: [PATCH] Update 2 files

- /meson_options.txt
- /meson.build
---
 meson.build       | 33 ++++++++++++---------------------
 meson_options.txt |  6 ++++++
 2 files changed, 18 insertions(+), 21 deletions(-)

diff --git a/meson.build b/meson.build
index c27c073..4ba7c0f 100644
--- a/meson.build
+++ b/meson.build
@@ -43,9 +43,18 @@ config_h = configure_file(
         configuration: config_data
 )
 
-systemd_user_unit_dir = dependency('systemd').get_pkgconfig_variable('systemduserunitdir',
-                                                                     define_variable: ['prefix', prefix])
-systemd_dependency = dependency('libsystemd')
+have_logind = get_option('logind')
+if have_logind
+  logind_dep = dependency('libsystemd', required: false)
+
+  if not logind_dep.found()
+    logind_dep = dependency('libelogind', required: false)
+  endif
+
+  if not logind_dep.found()
+    error('No logind provider dependency found: tried libsystemd and libelogind')
+  endif
+endif
 
 dbus_proxies = []
 dbus_proxies += {
@@ -135,7 +144,6 @@ compositor_dependencies += dependency('gdk-pixbuf-2.0')
 compositor_dependencies += dependency(libmutter_cogl_name)
 compositor_dependencies += dependency(libmutter_clutter_name)
 compositor_dependencies += mutter_dependency
-compositor_dependencies += systemd_dependency
 
 compositor_headers = []
 compositor_headers += 'compositor/kiosk-app.h'
@@ -199,24 +207,10 @@ i18n.merge_file(
         type: 'desktop'
 )
 
-systemd_service_config_data = configuration_data()
-systemd_service_config_data.set('bindir', bindir)
-
-systemd_service_files = []
-systemd_service_files += 'compositor/data/systemd/org.gnome.Kiosk@wayland.service.in'
 if mutter_have_x11
         systemd_service_files += 'compositor/data/systemd/org.gnome.Kiosk@x11.service.in'
 endif
 
-foreach service_file : systemd_service_files
-        configure_file(
-                input: service_file,
-                output: '@BASENAME@',
-                configuration: systemd_service_config_data,
-                install_dir: systemd_user_unit_dir
-        )
-endforeach
-
 targetconf = configuration_data()
 
 sessions_wants = ['org.gnome.Kiosk@wayland.service']
@@ -231,9 +225,6 @@ target = configure_file(
         install_dir: systemd_user_unit_dir
 )
 
-systemd_service_config_data = configuration_data()
-systemd_service_config_data.set('bindir', bindir)
-
 dconf_config_data = configuration_data()
 dconf_config_data.set('PACKAGE', meson.project_name())
 dconf_config_data.set('DATADIR', datadir)
diff --git a/meson_options.txt b/meson_options.txt
index 900652d..f9f9d23 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -15,3 +15,9 @@ option('search-app',
   value: true,
   description: 'Build kiosk search app example'
 )
+
+option('logind',
+  type: 'boolean',
+  value: true,
+  description: 'Enable logind support'
+)
-- 
GitLab

From c97ea38e67db64c718c2815a388352276d6904e9 Mon Sep 17 00:00:00 2001
From: Nathaniel Russell <naterussell83@gmail.com>
Date: Fri, 7 Mar 2025 00:30:57 +0000
Subject: [PATCH] Update file meson.build

---
 meson.build | 10 ----------
 1 file changed, 10 deletions(-)

diff --git a/meson.build b/meson.build
index 4ba7c0f..dfeb6d2 100644
--- a/meson.build
+++ b/meson.build
@@ -207,10 +207,6 @@ i18n.merge_file(
         type: 'desktop'
 )
 
-if mutter_have_x11
-        systemd_service_files += 'compositor/data/systemd/org.gnome.Kiosk@x11.service.in'
-endif
-
 targetconf = configuration_data()
 
 sessions_wants = ['org.gnome.Kiosk@wayland.service']
@@ -218,12 +214,6 @@ if mutter_have_x11
         sessions_wants += ['org.gnome.Kiosk@x11.service']
 endif
 targetconf.set('SUPPORTED_SESSIONS', ' '.join(sessions_wants))
-target = configure_file(
-        input: 'compositor/data/systemd/org.gnome.Kiosk.target.in',
-        output: 'org.gnome.Kiosk.target',
-        configuration: targetconf,
-        install_dir: systemd_user_unit_dir
-)
 
 dconf_config_data = configuration_data()
 dconf_config_data.set('PACKAGE', meson.project_name())
-- 
GitLab

From 3ddf2ef030f2c3e07bfba9fde03a82c4927d7c97 Mon Sep 17 00:00:00 2001
From: Nathaniel Russell <naterussell83@gmail.com>
Date: Fri, 7 Mar 2025 00:32:02 +0000
Subject: [PATCH] Update file meson.build

---
 kiosk-script/meson.build | 12 ------------
 1 file changed, 12 deletions(-)

diff --git a/kiosk-script/meson.build b/kiosk-script/meson.build
index e02bb88..7458858 100644
--- a/kiosk-script/meson.build
+++ b/kiosk-script/meson.build
@@ -18,18 +18,6 @@ i18n.merge_file(
         type: 'desktop'
 )
 
-configure_file(
-       input: 'systemd/org.gnome.Kiosk.Script.service.in',
-       output: '@BASENAME@',
-       configuration: systemd_service_config_data,
-       install_dir: systemd_user_unit_dir
-)
-
-kiosk_script_systemd_target_dir = join_paths(systemd_user_unit_dir, 'gnome-session@gnome-kiosk-script.target.d')
-install_data('systemd/session.conf',
-        install_dir: kiosk_script_systemd_target_dir
-)
-
 install_data('gnome-session/gnome-kiosk-script.session',
         install_dir: session_dir,
 )
-- 
GitLab

From 48654142461f7807070ee720d6297363fda1ea02 Mon Sep 17 00:00:00 2001
From: Nathaniel Russell <naterussell83@gmail.com>
Date: Fri, 7 Mar 2025 00:33:16 +0000
Subject: [PATCH] Update file meson.build

---
 search-app/meson.build | 12 ------------
 1 file changed, 12 deletions(-)

diff --git a/search-app/meson.build b/search-app/meson.build
index a1d683f..c6b91f5 100644
--- a/search-app/meson.build
+++ b/search-app/meson.build
@@ -38,15 +38,3 @@ i18n.merge_file(
         install_dir: desktop_data_dir,
         type: 'desktop'
 )
-
-configure_file(
-       input: 'systemd/org.gnome.Kiosk.SearchApp.service.in',
-       output: '@BASENAME@',
-       configuration: systemd_service_config_data,
-       install_dir: systemd_user_unit_dir
-)
-
-kiosk_search_appliance_systemd_target_dir = join_paths(systemd_user_unit_dir, 'gnome-session@org.gnome.Kiosk.SearchApp.target.d')
-install_data('systemd/session.conf',
-        install_dir: kiosk_search_appliance_systemd_target_dir
-)
-- 
GitLab

From c9eb493fe2748c9b3bd463614aa1badec19c2bc0 Mon Sep 17 00:00:00 2001
From: Nathaniel Russell <naterussell83@gmail.com>
Date: Fri, 7 Mar 2025 00:39:34 +0000
Subject: [PATCH] Update file kiosk-compositor.c

---
 compositor/kiosk-compositor.c | 6 ------
 1 file changed, 6 deletions(-)

diff --git a/compositor/kiosk-compositor.c b/compositor/kiosk-compositor.c
index f79cbc4..a9bc0de 100644
--- a/compositor/kiosk-compositor.c
+++ b/compositor/kiosk-compositor.c
@@ -134,12 +134,6 @@ register_with_display_manager (KioskCompositor *self)
         }
 }
 
-static void
-register_with_systemd (KioskCompositor *self)
-{
-        sd_notify (TRUE, "READY=1");
-}
-
 static void
 register_session (KioskCompositor *self)
 {
-- 
GitLab

